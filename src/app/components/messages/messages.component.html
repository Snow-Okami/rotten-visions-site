<div class="content-wrapper">
  <div class="body">

    <!-- Messages Card Starts Here -->
    <mat-card>

      <!-- Messages Title Bar Starts Here -->
      <div class="row">

        <!-- Back Button Appears Here -->
        <div class="col w20"></div> <div class="col w2"> </div> <div class="col w2"></div>

        <!-- Message Title Will Appear Here -->
        <div class="col w70 t-al-center card-title" style="max-width: 750px;">
          <button mat-icon-button matTooltip="Back" [matTooltipPosition]="'above'" class="back" [ngClass]="{ 'hidden': !chatView }" (click)="hideMessages()">
            <mat-icon aria-label="icon-button">arrow_back</mat-icon>
          </button>

          <mat-icon matPrefix class="title-item"> chat </mat-icon>
          <h4 class="title-item m-l-5" [ngClass]="{ 'hidden': !chatView }"> Messages - {{ chat.type ? chat.fullName : chat.users | nameonly: user }} </h4>

          <!-- User's own name appears when no chat selected. -->
          <h4 class="title-item m-l-5" [ngClass]="{ 'hidden': chatView }"> Welcome {{ user.firstName }}! </h4>

          <button mat-icon-button matTooltip="Show/Hide your text before send" [matTooltipPosition]="'above'" class="visibility" [ngClass]="{ 'hidden': !chatView }" (click)="alterQuickText()">
            <mat-icon aria-label="icon-button" [ngClass]="{ 'hidden': quickText }">visibility_off</mat-icon>
            <mat-icon aria-label="icon-button" [ngClass]="{ 'hidden': !quickText }">visibility</mat-icon>
          </button>
        </div>

      </div>

      <!-- Chat List Wrapper Starts Here -->
      <div class="row">
        <div class="col w20">

          <perfect-scrollbar #chatList style="position: relative; max-width: 230px; max-height: 414px; min-height: 414px;" [config]="config" (psYReachEnd)="loadChats($event)">
            <mat-list>

              <!-- Message loader will be shown here -->
              <ul *ngIf="chatLoader">
                <li class="row chat-row-wrapper t-al-center">
                  <div class="col">
                    <mat-progress-spinner class="chat-loader" [color]="'primary'" [mode]="'indeterminate'" [diameter]="30" [strokeWidth]="4"></mat-progress-spinner>
                  </div>
                </li>
              </ul>

              <!-- Messages will be loaded here -->
              <mat-list-item *ngFor="let c of chats">
                <mat-icon mat-list-icon class="chat-image"> person </mat-icon>
                <h4 mat-line class="chat-name" (click)="showItsMessages(c)"> {{ c.type ? c.fullName : c.users | nameonly: user }} </h4>
                <span [innerHTML]="sanitizer.bypassSecurityTrustHtml(c.lastMessage.text)" class="writable" mat-line></span>
                <mat-divider></mat-divider>
              </mat-list-item>

            </mat-list>
          </perfect-scrollbar>

        </div>

        <div class="col w2"> <mat-divider style="max-height: 414px; min-height: 414px;" [vertical]="true"></mat-divider> </div>

        <div class="col w2"> </div>

        <!-- SHOW for the messages -->
        <div class="col w70" [ngClass]="{ 'hidden': !chatView }">

          <perfect-scrollbar #messageList style="position: relative; max-width: 750px; max-height: 336px; min-height: 336px;" [config]="config" (psYReachStart)="loadMessages($event)">
            <mat-list>

              <ul>

                <!-- Message loader will be shown here -->
                <li class="row chat-row-wrapper t-al-center" *ngIf="messageLoader">
                  <div class="col">
                    <mat-progress-spinner class="message-loader" [color]="'primary'" [mode]="'indeterminate'" [diameter]="30" [strokeWidth]="4"></mat-progress-spinner>
                  </div>
                </li>

                <!-- Messages will repeat here -->
                <li *ngFor="let m of messages" class="row chat-row-wrapper">
                  <div class="chat-wrapper" [ngClass]="{ 'right': m.createdBy.email === user.email, 'm-r-30': m.createdBy.email !== user.email, 'm-l-30': m.createdBy.email === user.email }">
                    <div class="t-al-center chat-image"><mat-icon mat-list-icon> person </mat-icon></div>

                    <div class="col wauto">
                      <span [innerHTML]="sanitizer.bypassSecurityTrustHtml(m.text)" class="writable"></span>
                      <h4 class="mat-line"> {{ m.createdBy.fullName }} </h4>
                    </div>
                  </div>
                </li>

              </ul>

            </mat-list>
          </perfect-scrollbar>

          <!-- Input Section Will Be Used For Message -->
          <div class="row" style="max-width: 750px;">
            <mat-card class="chat-input-wrapper">
              <mat-card-content>

                <div class="col w90">
                  <mat-form-field>
                    <textarea matInput #message matTextareaAutosize placeholder="Say something..." [formControl]="text"></textarea>
                  </mat-form-field>
                </div>

                <div class="col w10 t-al-center v-al-b send-btn">
                  <button mat-icon-button matTooltip="Send" [matTooltipPosition]="'above'" (click)="sendThis()">
                    <mat-icon aria-label="send-button"> send </mat-icon>
                  </button>
                </div>
              </mat-card-content>
            </mat-card>

          </div>

        </div>

        <!-- SHOW when no chat is selected -->
        <div class="col w70" [ngClass]="{ 'hidden': chatView }">
          <div style="height: 414px; position: relative; max-width: 750px;">
            <h4 class="init-text t-al-center"> SORRY! no chat selected! </h4>
          </div>
        </div>

      </div>

    </mat-card>
    <!-- Messages Card Ends Here -->

  </div>
</div>
